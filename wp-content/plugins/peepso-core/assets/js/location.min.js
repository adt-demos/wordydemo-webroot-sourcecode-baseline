!function i(n,a,s){function l(e,t){if(!a[e]){if(!n[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(c)return c(e,!0);throw(o=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",o}o=a[e]={exports:{}},n[e][0].call(o.exports,function(t){return l(n[e][1][t]||t)},o,o.exports,i,n,a,s)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<s.length;t++)l(s[t]);return l}({1:[function(t,e,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e,l=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e};function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,n=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(i=(s=l.next()).done)&&(o.push(s.value),!e||o.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(n)throw a}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return i(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}function n(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=("undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null).location.api_key,c=null,o=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c=c||this}var e,o,i;return e=t,(o=[{key:"search",value:function(e){var n=this;return new Promise(function(o,i){n.autocompleteService().then(function(t){t.getPlacePredictions({input:e},function(t,e){"OK"===e?(console.log(t),o(t.map(n.mapData))):i(e)})})})}},{key:"geocode",value:function(t){var n=this;return new Promise(function(o,i){n.loadAPI().then(function(){(new google.maps.Geocoder).geocode({address:t},function(t,e){"OK"===e?o(n.mapData(t[0])):i(e)})})})}},{key:"mapData",value:function(t){var e,o,i=t.place_id,n=t.geometry,a=s((t.formatted_address||t.description).split(/,\s(.+)?/),2),t=a[0],a=a[1],a=void 0===a?"":a;return n&&(e=n.location.toJSON(),o=n.viewport.toJSON()),{id:i,name:t,description:a,location:e,viewport:o}}},{key:"render",value:function(t,e){var o=(0,l.default)(t).show(),i=o.data("psMap"),n=o.data("psMapMarker"),a=e.name,s=e.location,e=e.viewport;i||o.data("psMap",i=new google.maps.Map(t,{center:s,disableDefaultUI:!0,draggable:!1,scrollwheel:!1,zoom:15})),n||o.data("psMapMarker",n=new google.maps.Marker({map:i,position:s,title:a})),i.setCenter(s),i.fitBounds(e),n.setPosition(s)}},{key:"loadAPI",value:function(){var i=this;return new Promise(function(t,e){var o;i.loaded?t():(i.queue=i.queue||[],i.queue.push({resolve:t,reject:e}),i.loading||(i.loading=!0,o=_.uniqueId("psCallback"),(e=document.createElement("script")).type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(a?"&key="+a:"")+"&callback="+o,window[o]=function(){for(i.loaded=!0,i.loading=!1;i.queue.length;)i.queue.shift().resolve();delete window[o]},document.body.appendChild(e)))})}},{key:"autocompleteService",value:function(){var o=this;return new Promise(function(e,t){o.loadAPI().then(function(){var t="_cacheAutocompleteService";o[t]=o[t]||new google.maps.places.AutocompleteService,e(o[t])})})}},{key:"placesService",value:function(){var i=this;return new Promise(function(o,t){i.loadAPI().then(function(){var t="_cachePlacesService",e=document.createElement("div");document.body.appendChild(e),i[t]=i[t]||new google.maps.places.PlacesService(e),o(i[t])})})}},{key:"placeDetail",value:function(a){var s=this;return new Promise(function(i,n){s.placesService().then(function(t){var o="_cachePlaceDetail";s[o]=s[o]||{},s[o][a]?i(s[o][a]):t.getDetails({placeId:a},function(t,e){"OK"===e?(t=s.mapData(t),s[o][a]=t,i(t)):n(e)})})})}}])&&n(e.prototype,o),i&&n(e,i),t}();r.default=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(n,t,e){(function(t){"use strict";var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},o="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;n("./google-maps"),n("./location"),n("./postbox"),o.observer.addFilter("human_friendly_extras",function(t,e,o){return e||!o||(o=(0,i.default)(o).find(".ps-js-activity-extras [data-preview]")).length&&t.push(o.data("preview")),t},20,3)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./google-maps":1,"./location":3,"./postbox":4}],3:[function(t,e,o){(function(t){"use strict";var e,o,r,i,u,h=(e="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null)&&e.__esModule?e:{default:e};function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(){this.coords=null,this.$places_container=null,this.$input_search=null,this.marker=null,this.map=null,this.selected_place=null,this._search_service=null,this._latLang=null,this.last_selected_place=null,this.location_selected=!1,this.can_submit=!1}o=window,r=jQuery,o.pslocation=(i=o,u=r,a.prototype.init=function(){var i,o;_.isNull(this.$postbox)||(i=this,peepso.observer.addFilter("peepso_postbox_can_submit",function(t){return t.soft.push(i.can_submit),t},30,1),this.$container=this.$postbox.find("#location-tab"),u(this.$postbox).on("click","#location-tab a",function(){i.toggle_input()}),this.$input_search=u("[name=postbox_loc_search]",this.$postbox),this.$dropdown=u("#pslocation",this.$postbox).on("click",function(t){t.stopPropagation()}),this.$postboxcontainer=this.$postbox.$textarea.parent(),this.$places_container=u(".ps-js-postbox-locations",this.$dropdown),o=null,this.$input_search.on("keyup",function(){var t=this;clearTimeout(o);var e=u('<div class="ps-postbox__location-item ps-postbox__location-item--loading ps-js-postbox-location-item">'+u("#pslocation-search-loading").html()+"</div>");i.$places_container.html(e),o=setTimeout(function(){i.location_search(u(t).val())},1500)}),peepso.observer.addFilter("postbox_req_"+this.$postbox.guid,function(t,e){return i.postbox_request(t,e)},10,1),this.$postbox.on("postbox.post_cancel postbox.post_saved",function(t,e,o){i.postbox_cancel_saved(e,o)}),this.$select_location=u(".ps-js-location-action .ps-js-add-location",this.$dropdown),this.$remove_location=u(".ps-js-location-action .ps-js-remove-location",this.$dropdown),this.$select_location.on("click",function(t){t.preventDefault(),i.on_select_location()}),this.$remove_location.on("click",function(t){t.preventDefault(),i.on_remove_location()}),u(this.$postbox).on("peepso.interaction-hide","#location-tab a",function(){i.$dropdown.hide(),i.$container.removeClass("ps-postbox__menu-item--open")}),peepso.observer.addFilter("peepso_postbox_addons_update",function(t){return i.location_selected&&t.unshift("<b><i class=ps-icon-map-marker></i>"+i.location_selected+"</b>"),t},10,1))},a.prototype.postbox_request=function(t,e){return null!==this.selected_place&&(t.location={name:this.selected_place.name,latitude:this.selected_place.geometry.location.lat(),longitude:this.selected_place.geometry.location.lng()}),t},a.prototype.postbox_cancel_saved=function(t,e){this.$dropdown.hide(),this.$input_search.val(""),this.$remove_location.hide(),this.$select_location.show(),this.$postboxcontainer.find("span#postlocation").remove(),this.$container.removeClass("active"),this.selected_place=null,this.location_selected=!1,this.can_submit=!1,this.$postbox.on_change()},a.prototype.set_postbox=function(t){this.$postbox=t},a.prototype.location_search=function(t,o){var i=this;_.isEmpty(this.map)&&(this._latLang=new google.maps.LatLng(0,0),this.draw_map(this._latLang)),_.isEmpty(t)?this.draw_map(this._latLang):this.get_search_service().textSearch({query:t,location:this._latLang,radius:5e4},function(t,e){i.set_places(t,e),i.$select_location.is(":visible")||i.$places_container.find(".ps-js-postbox-location-item").first().trigger("click"),("undefined"==typeof Function?"undefined":n(Function))===n(o)&&o()})},a.prototype.on_select_location=function(){null===this.selected_place&&(this.selected_place=this.last_selected_place),this.$select_location.hide(),this.$remove_location.show(),this.$dropdown.hide(),this.$container.addClass("active"),this.$container.removeClass("ps-postbox__menu-item--open"),this.location_selected="",this.selected_place&&(this.location_selected=this.selected_place.name),this.can_submit=!0,this.$postbox.on_change()},a.prototype.on_remove_location=function(){this.$select_location.show(),this.$remove_location.hide(),this.selected_place=null,this.$postboxcontainer.find("span#postlocation").remove(),this.$dropdown.hide(),this.$container.removeClass("active"),this.$container.removeClass("ps-postbox__menu-item--open"),this.location_selected=!1,this.can_submit=!1,this.$postbox.on_change()},a.prototype.toggle_input=function(){var t;this.$dropdown.is(":visible")?(this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),jQuery(document).off("mouseup.ps-postbox-location")):(this.$dropdown.show(),this.$container.addClass("ps-postbox__menu-item--open"),setTimeout(u.proxy(function(){jQuery(document).off("mouseup.ps-postbox-location").on("mouseup.ps-postbox-location",u.proxy(function(t){0===this.$container.has(t.target).length&&(this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),jQuery(document).off("mouseup.ps-postbox-location"))},this))},this),1)),this.$input_search.val(""),this.location=null,this.$dropdown.is(":visible")&&(t=this).load_library(function(){t.shown()}.bind(t))},a.prototype.shown=function(){var o=this;this.$input_search.focus(),!1!==_.isEmpty(this.map)&&this.detect_location().done(function(t,e){o.draw_default_map(t,e)}).fail(function(){o.draw_default_map()})},a.prototype.draw_default_map=function(t,e){t&&e?(e=new google.maps.LatLng(t,e),this.draw_map(e)):(this.$postbox.find(".ps-js-postbox-map").show(),this.$input_search.removeAttr("disabled"),this.$input_search.focus())},a.prototype.draw_map=function(t,e){var o,i;!1===_.isBoolean(e)&&(e=!0),!1!=t instanceof google.maps.LatLng&&(o=this.$postbox.find(".ps-js-postbox-map"),u("#pslocation .ps-postbox-loading",this.$postbox).hide(),o.show(),this.$input_search.removeAttr("disabled"),t={center:(i=this)._latLang=t,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0},peepso.observer.applyFilters("ps_location_before_draw_map",u("#pslocation",this.$postbox)),_.isEmpty(this.map)?(this.map=new google.maps.Map(o.get(0),t),this.marker=new google.maps.Marker({position:t.center,map:this.map,title:"You are here (more or less)"})):this.set_map_center(this._latLang),e&&(e={location:this._latLang,types:["establishment"],rankBy:google.maps.places.RankBy.DISTANCE},this.get_search_service().nearbySearch(e,function(t,e){i.set_places(t,e),i.$select_location.is(":visible")||i.$places_container.find(".ps-js-postbox-location-item").first().trigger("click")})))},a.prototype.get_search_service=function(){return _.isEmpty(this.search_service)&&(this._search_service=new google.maps.places.PlacesService(this.map)),this._search_service},a.prototype.set_places=function(t,e){var o=this;if(this.$places_container.find(".ps-js-postbox-location-item").remove(),e===google.maps.places.PlacesServiceStatus.OK)for(var i=0;i<t.length;i++)this.add_place(t[i]);u(".ps-js-postbox-location-item",this.$places_container).on("click",function(){u(".ps-js-location-action",this.$dropdown).show(),o.$select_location.show(),o.$remove_location.hide()})},a.prototype.add_place=function(t){var e,o;_.isEmpty(t.formatted_address)||(t.vicinity=t.formatted_address),_.isEmpty(t.vicinity)||(e=this,(o=u('<div class="ps-postbox__location-item ps-js-postbox-location-item"></div>')).append("<p>"+t.name+"</p>"),o.append("<span>"+t.vicinity+"</span>"),this.$places_container.append(o),o.on("click",function(){e.set_map_center(t.geometry.location),e.$input_search.val(t.name),e.selected_place=t,e.last_selected_place=e.selected_place}))},a.prototype.set_map_center=function(t){this.map.setCenter(t),this.marker.setPosition(t)},a.prototype.load_library=function(t){var e,o;this.gmap_is_loaded?t():(this.load_library_callbacks||(this.load_library_callbacks=[]),this.load_library_callbacks.push(t),this.gmap_is_loading||(this.gmap_is_loading=!0,e=document.createElement("script"),t=h.default.location.api_key,o=this,e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(t?"&key="+t:"")+"&callback=ps_gmap_callback",i.ps_gmap_callback=function(){for(o.gmap_is_loaded=!0,o.gmap_is_loading=!1;o.load_library_callbacks.length;)o.load_library_callbacks.shift()();delete i.ps_gmap_callback},document.body.appendChild(e)))},a.prototype.show_map=function(i,n,t){peepso.lightbox([{content:'<div class="ps-location__map ps-js-mapct" />'}],{simple:!0,nofulllink:!0,afterchange:u.proxy(function(o){this.load_library(function(){var t=o.$container.find(".ps-js-mapct"),e=new google.maps.LatLng(i,n),t=new google.maps.Map(t[0],{center:e,zoom:14});new google.maps.Marker({position:e,map:t})})},this)})},a.prototype.init_location_search=function(i){var n,a,s,t,l,c,r,p,e,d;i.data("location-search")||(i.data("location-search",1),t=h.default.location.template_selector,(n=u(t)).children(".ps-js-location"),a=n.find(".ps-js-location-map"),s=n.find(".ps-js-location-list"),t=n.find(".ps-js-close"),l=n.find(".ps-js-select"),c=n.find(".ps-js-remove"),r=n.find(".ps-js-location-loading"),p=n.find(".ps-js-location-result"),e=n.find(".ps-js-location-placeholder"),d=n.find(".ps-js-location-listitem").get(0).outerHTML,i.on("input.ps-location",u.proxy(_.debounce(function(t){t=t.target.value;t&&(e&&(e.remove(),e=null),p.hide(),r.show(),n.show(),this.search(t).done(function(t){for(var e,o=[],i=0;i<t.length;i++)e=(e=t[i].description).split(/,\s(.+)?/),e=d.replace("{place_id}",t[i].place_id).replace("{name}",e[0]).replace("{description}",e[1]||"&nbsp;"),o.push(e);s.html(o.join("")),r.hide(),p.show(),n.show()}))},200),this)),i.on("blur.ps-location",u.proxy(function(t){n.hide(),l.hide(),i.val(i.data("location")||""),i.data("location")&&c.show()},this)),i.on("focus.ps-location",u.proxy(function(t){s.find(".ps-location-selected").removeClass("ps-location-selected"),n.show()},this)),s.on("mousedown","a.ps-js-location-listitem",u.proxy(function(t){var e=u(t.currentTarget),o=(e.find(".ps-js-location-listitem-name").text(),e.data("place-id"));t.preventDefault(),t.stopPropagation(),e.addClass("ps-location-selected"),e.siblings().removeClass("ps-location-selected"),l.show(),c.hide(),a.show(),this._gmap_get_place_detail(o).done(u.proxy(function(t){var e=t.name,o=t.geometry.location;i.data("tmp-location",e).data("tmp-latitude",o.lat()).data("tmp-longitude",o.lng()),this._gmap_render_map(a[0],t)},this))},this)),t.on("mousedown",function(){i.trigger("blur.ps-location")}),l.on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),i.data("location",i.data("tmp-location")),i.data("latitude",i.data("tmp-latitude")),i.data("longitude",i.data("tmp-longitude")),i.val(i.data("location")),l.hide(),c.show(),i.trigger("blur.ps-location")}),c.on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),i.removeData("location").removeData("latitude").removeData("longitude").val(""),s.find(".ps-location-selected").removeClass("ps-location-selected"),c.hide(),a.hide()}),n.insertAfter(i))},a.prototype.search=function(e){return u.Deferred(u.proxy(function(o){this._gmap_get_autocomplete_service().done(function(t){t.getPlacePredictions({input:e},function(t,e){"OK"===e&&o.resolve(t)})})},this))},a.prototype.detect_location=function(){var t=this;return u.Deferred(function(o){"https:"!==i.location.protocol?o.reject():t.detect_location_by_device().done(function(t,e){o.resolve(t,e)}).fail(function(){t.detect_location_by_gmap_api().done(function(t,e){o.resolve(t,e)}).fail(function(){t.detect_location_by_ip().done(function(t,e){o.resolve(t,e)}).fail(function(){o.reject()})})})})},a.prototype.detect_location_by_device=function(){return u.Deferred(u.proxy(function(e){navigator.geolocation.getCurrentPosition(function(t){e.resolve(t.coords.latitude,t.coords.longitude)},function(){e.reject()},{timeout:1e4})},this))},a.prototype.detect_location_by_gmap_api=function(){return u.Deferred(u.proxy(function(e){var t=h.default.location.api_key;this._client_location?e.resolve(this._client_location):t?u.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+t,function(t){e.resolve(t.location.lat,t.location.lng)}).fail(function(t){e.reject(t)}):e.reject()},this))},a.prototype.detect_location_by_ip=function(){return u.Deferred(u.proxy(function(o){var i;u.ajax({url:"https://ipapi.co/jsonp",dataType:"jsonp",success:function(t){var e=t.latitude,t=t.longitude;e&&t&&(i=!0,o.resolve(e,t))},complete:function(){i||o.reject()}})},this))},a.prototype._gmap_load_library=function(){return u.Deferred(u.proxy(function(t){this.load_library(function(){t.resolve()})},this))},a.prototype._gmap_get_autocomplete_service=function(){return u.Deferred(u.proxy(function(t){this._gmap_autocomplete_service?t.resolve(this._gmap_autocomplete_service):this._gmap_load_library().done(u.proxy(function(){this._gmap_autocomplete_service=new google.maps.places.AutocompleteService,t.resolve(this._gmap_autocomplete_service)},this))},this))},a.prototype._gmap_render_map=function(t,e){var o,i,n;e.geometry?(o=e.geometry.location,i=e.geometry.viewport):o=new google.maps.LatLng(e.latitude,e.longitude),n=(t=u(t).show()).data("ps-map"),e=t.data("ps-map-marker"),n||(n=new google.maps.Map(t[0],{center:o,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0}),t.data("ps-map",n)),e||(e=new google.maps.Marker({position:o,map:n,title:"You are here (more or less)"}),t.data("ps-map-marker",e)),n.setCenter(o),e.setPosition(o),i?n.fitBounds(i):n.setZoom(15)},a.prototype._gmap_get_place_service=function(){return u.Deferred(u.proxy(function(e){this._gmap_place_service?e.resolve(this._gmap_place_service):this._gmap_load_library().done(u.proxy(function(){var t=document.createElement("div");document.body.appendChild(t),this._gmap_place_service=new google.maps.places.PlacesService(t),e.resolve(this._gmap_place_service)},this))},this))},a.prototype._gmap_get_place_detail=function(i){return u.Deferred(u.proxy(function(o){this._gmap_place_cache&&this._gmap_place_cache[i]?o.resolve(this._gmap_place_cache[i]):this._gmap_get_place_service().done(u.proxy(function(t){t.getDetails({placeId:i},u.proxy(function(t,e){"OK"===e?(this._gmap_place_cache||(this._gmap_place_cache={}),this._gmap_place_cache[i]=t,o.resolve(t)):o.reject(e)},this))},this))},this))},peepso.observer.addFilter("peepso_postbox_addons",function(t){return t.push(new a),t},10,1),new a),peepso.observer.addFilter("photo_create_album",function(t){var e=t.popup.find(".ps-js-location");return pslocation.init_location_search(e),t},10,1),r(function(){peepso.observer.addFilter("profile_field_save",function(t,e){if(e.hasClass("ps-js-field-location")){e=e.data();if(e.location&&e.latitude&&e.longitude)return JSON.stringify({name:e.location,latitude:e.latitude,longitude:e.longitude})}return t},10,2),peepso.observer.addAction("profile_field_save_register",function(t){var e,o;!t.hasClass("ps-js-field-location")||(e=t.data()).location&&e.latitude&&e.longitude&&(o=r('<input type="hidden" name="'+t.attr("name")+'" />'),t.removeAttr("name"),o.insertAfter(t),o.val(JSON.stringify({name:e.location,latitude:e.latitude,longitude:e.longitude})))},10,1),r(".ps-js-field-location").each(function(){pslocation.init_location_search(r(this))})}),r(function(){var t,e=r(".ps-js-album-location"),i=e.find(".ps-js-album-location-text"),n=e.find(".ps-js-album-location-empty"),a=e.find(".ps-js-album-location-editor"),s=e.find(".ps-js-album-location-edit"),l=e.find(".ps-js-album-location-remove"),c=(a.find(".ps-js-submit"),a.find("input").eq(0));s.click(function(){a.is(":visible")||(i.hide(),n.hide(),s.hide(),l.hide(),a.show(),c.data("original-value",t=c.val()),c.focus().val("").val(t),pslocation.init_location_search(c),a.off("click input"),a.on("click",".ps-js-cancel",function(){c.val(t),a.off("click").hide(),s.show(),t?(i.show(),l.show()):n.show()}),a.on("click",".ps-js-submit",r.proxy(function(t){var e=c.data(),o={user_id:h.default.userid,post_id:e.postId,type_extra_field:"location","location[name]":e.location,"location[latitude]":e.latitude,"location[longitude]":e.longitude,_wpnonce:r("#_wpnonce_set_album_location").val()};peepso.postJson("photosajax.set_album_extra_field",o,function(t){t.success&&(a.off("click").hide(),c.val(e.location),i.find("span").html(e.location),i.show(),n.hide(),s.show(),l.show())})},this)))}),l.click(function(){var t=l.data(),t={user_id:h.default.userid,post_id:t.postId,type_extra_field:"location",location:"",_wpnonce:r("#_wpnonce_set_album_location").val()};peepso.postJson("photosajax.set_album_extra_field",t,function(t){t.success&&(c.val(""),i.find("span").html(""),i.hide(),n.show(),l.hide())})})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,o){"use strict";function i(){this.__constructor.apply(this,arguments)}var n,a,s,l;n=jQuery,a=n,s=".ps-postbox-location",i.prototype={__constructor:function(t){var e=peepsodata.location&&peepsodata.location.template_postbox||"";this.postbox=t,this.$container=t.$el.find("#location-tab"),this.$toggle=this.$container.find(".ps-js-postbox-toggle"),this.$dropdown=this.$container.find(".ps-js-postbox-location").html(e),this.$input=this.$dropdown.find("input[type=text]"),this.$loading=this.$dropdown.find(".ps-js-location-loading"),this.$result=this.$dropdown.find(".ps-js-location-result"),this.$map=this.$dropdown.find(".ps-js-location-map"),this.$select=this.$dropdown.find(".ps-js-select"),this.$remove=this.$dropdown.find(".ps-js-remove"),this.listItemTemplate=peepso.template(this.$dropdown.find(".ps-js-location-fragment").text()),this.$toggle.on("click"+s,a.proxy(this.onToggle,this)),this.$input.on("input"+s,a.proxy(this.onInput,this)),this.$result.on("mousedown"+s,".ps-js-location-listitem",a.proxy(this.onSelectItem,this)),this.$result.on("click"+s,".ps-js-location-listitem",function(t){return t.preventDefault()}),this.$select.on("mousedown"+s,a.proxy(this.onSelect,this)),this.$remove.on("mousedown"+s,a.proxy(this.onRemove,this)),t.addAction("update",this.update,10,2,this),t.addFilter("render_addons",this.render,10,1,this),t.addFilter("data",this.filterData,10,1,this),t.addFilter("data_validate",this.validate,10,2,this)},show:function(){var e=this;this.$dropdown.show(),this.$container.addClass("ps-postbox__menu-item--open"),setTimeout(function(){a(document).off("mouseup.ps-postbox-location").on("mouseup.ps-postbox-location",function(t){0===e.$container.has(t.target).length&&e.hide()})},1),this._needUpdate&&(this._needUpdate=!1,this._selected?(this.$select.hide(),this.$remove.show(),this.$result.empty(),this.$map.children().show(),this.$toggle.addClass("active"),this.updateList([{place_id:"",name:this._selected.name,description:this._selected.description}]),this.updateMap({latitude:this._selected.latitude,longitude:this._selected.longitude,zoom:this._selected.zoom})):(this.$select.hide(),this.$remove.hide(),this.$result.empty(),this.$map.children().hide(),this.$toggle.removeClass("active"),this.updateList([])))},hide:function(){this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),a(document).off("mouseup.ps-postbox-location")},toggle:function(){this.$dropdown.is(":visible")?this.hide():this.show()},search:function(t){this.$result.empty().append(this.$loading),pslocation.search(t).done(a.proxy(function(t){for(var e,o=[],i=0;i<t.length;i++)e=(e=t[i].description).split(/,\s(.+)?/),o.push({place_id:t[i].place_id,name:e[0],description:e[1]});this.$loading.detach(),this.updateList(o)},this))},filterData:function(t){return this._selected?t.location=this._selected:t.location="",t},validate:function(t){return!!this._selected||t},render:function(t){var e;return this._selected&&(e='<i class="gcis gci-map-marker-alt"></i>',e+="<strong>"+this._selected.name+"</strong>",t.push(e)),t},update:function(t){(t=t&&t.data||{}).location?(this._selected={name:t.location.name,description:t.location.description,latitude:t.location.latitude,longitude:t.location.longitude,zoom:t.location.zoom},this.$input.data("location",t.location.name),this.$input.data("latitude",t.location.latitude),this.$input.data("longitude",t.location.longitude),this.$input.val(t.location.name),this.$toggle.addClass("active")):(this._selected=!1,this.$toggle.removeClass("active")),this._needUpdate=!0,this.postbox.doAction("refresh")},updateList:function(t){for(var e=[],o=0;o<t.length;o++)e.push(this.listItemTemplate(t[o]));this.$result.html(e.join(""))},updateMap:function(t){pslocation._gmap_load_library().done(a.proxy(function(){pslocation._gmap_render_map(this.$map[0],t)},this))},select:function(){},remove:function(){},destroy:function(){this.$toggle.off("click")},onToggle:_.throttle(function(t){t.preventDefault(),t.stopPropagation();t=a(t.target);this.$dropdown.is(t)||this.$dropdown.find(t).length||this.toggle()},200),onInput:function(){var t=a.trim(this.$input.val());t&&(this.$result.empty().append(this.$loading),this._onInput(t))},_onInput:_.debounce(function(t){this.search(t)},200),onSelectItem:function(t){t.preventDefault(),t.stopPropagation();var e=a(t.currentTarget),t=e.data("place-id");e.addClass("ps-location-selected"),e.siblings().removeClass("ps-location-selected"),this.$select.show(),this.$remove.hide(),this.$map.children().show(),pslocation._gmap_get_place_detail(t).done(a.proxy(function(t){var e=t.name,o=t.geometry.location;this.$input.data("tmp-location",e).data("tmp-latitude",o.lat()).data("tmp-longitude",o.lng()),pslocation._gmap_render_map(this.$map[0],t)},this))},onSelect:function(t){t.preventDefault(),t.stopPropagation();var e=this.$input.data("tmp-location"),o=this.$input.data("tmp-latitude"),t=this.$input.data("tmp-longitude");this.$input.data("location",e),this.$input.data("latitude",o),this.$input.data("longitude",t),this.$input.val(e),this.$select.hide(),this.$remove.show(),this.$map.children().show(),this.$toggle.addClass("active"),this._selected={name:e,latitude:o,longitude:t},this.hide(),this.postbox.doAction("refresh")},onRemove:function(t){t.preventDefault(),t.stopPropagation(),this.$input.removeData("location").removeData("latitude").removeData("longitude").val(""),this.$select.hide(),this.$remove.hide(),this.$map.children().hide(),this.$toggle.removeClass("active"),this.$result.children().each(function(){var t=a(this);t.data("place-id")||t.remove()}),this._selected=!1,this.hide(),this.postbox.doAction("refresh")}},l=i,peepso.observer.addAction("postbox_init",function(t){new l(t)},10,1)},{}]},{},[2]);